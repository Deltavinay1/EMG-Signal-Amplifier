* lm324.lib - Wrapper + generic op amp macro for ngspice / KiCad
* Save this file as newLm324.lib in your project folder and .include it in the schematic.

* 14-pin LM324 wrapper mapping to 4 generic op-amps
* Pin order (package): 1  2    3    4   5    6    7   8   9    10  11  12   13   14
.SUBCKT LM324 OUTA INA_N INA_P VCC INB_P INB_N OUTB OUTC INC_N INC_P VEE IND_P IND_N OUTD

* X1 = Amp A  (maps package pins: IN A+, IN A-, VCC, VEE, OUTA)
X1 INA_P INA_N VCC VEE OUTA LM324_GENERIC

* X2 = Amp B
X2 INB_P INB_N VCC VEE OUTB LM324_GENERIC

* X3 = Amp C
X3 INC_P INC_N VCC VEE OUTC LM324_GENERIC

* X4 = Amp D
X4 IND_P IND_N VCC VEE OUTD LM324_GENERIC

.ENDS LM324


* -------------------- Generic 5-pin op-amp macro (node order IN+, IN-, V+, V-, OUT) -------------------
.SUBCKT LM324_GENERIC 1 2 3 4 5
* INPUT STAGE
  CIN  11  0 10.000E-12
  EIP  10  0 1 11 1
  EIN  11  2 12 0 1
  RIP  10  0 10.000E+06
  RIN  12  0 10.000E+06
  RIS  11 12 10.000E+03
  DIP  11 51 DMOD
  DIN  52 11 DMOD
  VIP  3  51 DC 1.5
  VIN  52  4 DC 1.5
  .MODEL DMOD D (IS=10.000E-18)
* GAIN STAGE
  GA   0  6 11 12 100.00E-06
  RA   6  0 1.0000E+06
* POLE 1
  C1   6  0 1.5915E-06
* OUTPUT STAGE
  EB   0  7 6 0 1
  RO1  7  0 100
  RO2  7  5 50
  DOP  7  53 DMOD
  DON  54  7 DMOD
  VOP  3  53 DC 0
  VON  54  4 DC 0
.ENDS LM324_GENERIC
